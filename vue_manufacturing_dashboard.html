<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에어코어 다이나믹스 - 제조 대시보드</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
        /* 배경: 세련된 다크 그라데이션으로 변경 */
        background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        /* 기본 텍스트 색상: 밝은 회색으로 변경 */
        color: #e0e0e0;
        min-height: 100vh;
    }

    .header {
        /* 헤더 배경: 반투명 다크 색상으로 변경 */
        background: rgba(28, 49, 58, 0.85);
        backdrop-filter: blur(10px);
        padding: 1rem 2rem;
        /* 그림자: 은은한 포인트 색상 그림자로 변경 */
        box-shadow: 0 2px 20px rgba(77, 208, 225, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        border-bottom: 1px solid rgba(77, 208, 225, 0.2);
    }

    .logo {
        font-size: 1.8rem;
        font-weight: bold;
        /* 로고 색상: 흰색으로 강조 */
        color: #ffffff;
    }

    .time-display {
        font-size: 1.1rem;
        color: #e0e0e0;
    }

    .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
    }

    .tab-navigation {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        /* 탭 배경: 어두운 반투명 색으로 변경 */
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 0.5rem;
        flex-wrap: wrap;
    }

    .tab-btn {
        padding: 0.75rem 1.5rem;
        background: transparent;
        color: #e0e0e0; /* 탭 버튼 텍스트 색상 변경 */
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .tab-btn.active {
        /* 활성 탭 배경: 포인트 색상으로 변경 */
        background: rgba(77, 208, 225, 0.3);
        color: #ffffff;
        backdrop-filter: blur(10px);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 1.5rem;
    }

    .card {
        /* 카드 배경: 반투명 다크 색상으로 변경 */
        background: rgba(28, 49, 58, 0.85);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 1.5rem;
        /* 그림자: 더 어두운 그림자로 변경 */
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        /* 테두리: 포인트 색상으로 변경 */
        border: 1px solid rgba(77, 208, 225, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.4);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        /* 카드 헤더 구분선 색상 변경 */
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        /* 카드 제목 색상 변경 */
        color: #f5f5f5;
    }

    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    /* 상태 색상은 그대로 유지 (직관성) */
    .status-good { background-color: #27ae60; }
    .status-warning { background-color: #f39c12; }
    .status-danger { background-color: #e74c3c; }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
        100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
    }

    .metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 0.5rem 0;
        padding: 0.5rem;
        /* 메트릭 배경색 변경 */
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
    }

    .metric-value {
        font-size: 1.2rem;
        font-weight: bold;
        /* 메트릭 값 색상: 포인트 색상으로 강조 */
        color: #4dd0e1;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        /* 프로그레스 바 배경색 변경 */
        background: rgba(0, 0, 0, 0.3);
        border-radius: 4px;
        overflow: hidden;
        margin: 0.5rem 0;
    }

    .progress-fill {
        height: 100%;
        /* 프로그레스 바 채움 색상 변경 */
        background: linear-gradient(90deg, #0097a7, #4dd0e1);
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    .cnc-container {
        grid-column: span 2;
        height: 400px;
        position: relative;
        overflow: hidden;
    }

    #cncViewer {
        width: 100%;
        height: 100%;
        border-radius: 12px;
        /* 3D 뷰어 배경색 변경 */
        background: #0f2027;
    }

    .cnc-controls {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
    }

    .cnc-btn {
        padding: 0.5rem 1rem;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
    }

    .cnc-status {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.9rem;
    }

    .equipment-status {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .equipment-item {
        text-align: center;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.2); /* 배경색 변경 */
        border-radius: 8px;
        transition: transform 0.3s ease;
        cursor: pointer;
    }

    .equipment-item:hover {
        transform: scale(1.05);
    }

    .equipment-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .alert-box {
        /* 알람 색상은 가시성을 위해 유지 */
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin: 0.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        animation: alertPulse 2s infinite;
    }

    @keyframes alertPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }

    .wide-card {
        grid-column: span 2;
    }

    .production-chart {
        height: 200px;
        background: rgba(0, 0, 0, 0.2); /* 배경색 변경 */
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        margin: 1rem 0;
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        padding: 1rem;
    }

    .chart-bar {
        /* 차트 바 색상 변경 */
        background: linear-gradient(0deg, #0097a7, #4dd0e1);
        border-radius: 4px 4px 0 0;
        width: 40px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        color: white;
        font-size: 0.7rem;
        font-weight: bold;
        padding-bottom: 0.25rem;
        transition: height 1s ease;
    }

    .line-selector {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .line-btn {
        padding: 0.5rem 1rem;
        background: rgba(0, 0, 0, 0.2);
        border: 2px solid transparent;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #e0e0e0; /* 텍스트 색상 변경 */
    }

    .line-btn.active {
        background: #00bcd4; /* 활성 버튼 배경색 변경 */
        color: white;
        border-color: #0097a7; /* 활성 버튼 테두리 색상 변경 */
    }

    @media (max-width: 1200px) {
        .cnc-container {
            grid-column: span 1;
        }
        .wide-card {
            grid-column: span 1;
        }
    }

    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
        .tab-navigation {
            justify-content: center;
        }
    }
</style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div class="logo">🏭 에어코어 다이나믹스</div>
            <div class="time-display" id="currentTime"></div>
        </div>

        <div class="container">
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="setActiveTab('dashboard')">대시보드</button>
                <button class="tab-btn" onclick="setActiveTab('lines')">라인별 상세</button>
                <button class="tab-btn" onclick="setActiveTab('prediction')">예측 분석</button>
                <button class="tab-btn" onclick="setActiveTab('inventory')">재고/출하</button>
            </div>

            <!-- 대시보드 탭 -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <!-- 3D CNC 뷰어 -->
                    <div class="card cnc-container">
                        <div class="card-header">
                            <div class="card-title">🔧 실시간 CNC 모니터링</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div id="cncViewer"></div>
                        <div class="cnc-controls">
                            <button class="cnc-btn" onclick="toggleCncAnimation()">
                                <span id="animationBtn">⏸️ 일시정지</span>
                            </button>
                            <button class="cnc-btn" onclick="resetCncView()">🔄 리셋</button>
                        </div>
                        <div class="cnc-status">
                            <div><strong>상태:</strong> <span id="cncStatusText">정상 가동 중</span></div>
                            <div><strong>가동률:</strong> <span id="cncEfficiency">89.2</span>%</div>
                            <div><strong>현재 작업:</strong> <span id="currentJob">매니폴드 가공</span></div>
                            <div><strong>완료:</strong> <span id="completed">47</span>/<span id="total">50</span></div>
                        </div>
                    </div>

                    <!-- 실시간 생산 현황 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">📊 실시간 생산 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>금일 생산량</span>
                            <span class="metric-value" id="dailyProduction">847 / 1,100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 77%"></div>
                        </div>
                        <div class="metric">
                            <span>전체 가동률</span>
                            <span class="metric-value" id="overallEfficiency">84.2%</span>
                        </div>
                        <div class="production-chart" id="productionChart">
                            <!-- 차트 바들이 여기에 동적으로 추가됩니다 -->
                        </div>
                    </div>

                    <!-- 품질 현황 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🎯 품질 현황</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div class="metric">
                            <span>검사 통과율</span>
                            <span class="metric-value" id="passRate">96.8%</span>
                        </div>
                        <div class="metric">
                            <span>불량률</span>
                            <span class="metric-value" style="color: #e74c3c;" id="defectRate">3.2%</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">주요 불량 유형:</div>
                            <div style="font-size: 0.8rem; color: #7f8c8d;" id="defectTypes">
                                • 기공: 1.8%<br>
                                • 치수오차: 0.9%<br>
                                • 조립불량: 0.5%
                            </div>
                        </div>
                    </div>

                    <!-- 설비 상태 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">⚙️ 설비 상태</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="equipment-status">
                            <div class="equipment-item" onclick="selectEquipment('furnace')">
                                <div class="equipment-icon">🔥</div>
                                <div style="font-size: 0.8rem;">용해로</div>
                                <div style="color: #27ae60; font-size: 0.8rem;">정상</div>
                            </div>
                            <div class="equipment-item" onclick="selectEquipment('cnc')">
                                <div class="equipment-icon">⚡</div>
                                <div style="font-size: 0.8rem;">CNC</div>
                                <div style="color: #27ae60; font-size: 0.8rem;">정상</div>
                            </div>
                            <div class="equipment-item" onclick="selectEquipment('inspector')">
                                <div class="equipment-icon">🔍</div>
                                <div style="font-size: 0.8rem;">검사대</div>
                                <div style="color: #f39c12; font-size: 0.8rem;">주의</div>
                            </div>
                            <div class="equipment-item" onclick="selectEquipment('robot')">
                                <div class="equipment-icon">🤖</div>
                                <div style="font-size: 0.8rem;">조립기</div>
                                <div style="color: #27ae60; font-size: 0.8rem;">정상</div>
                            </div>
                        </div>
                    </div>

                    <!-- 환경 데이터 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🌡️ 환경 모니터링</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>온도</span>
                            <span class="metric-value" id="temperature">23.4°C</span>
                        </div>
                        <div class="metric">
                            <span>습도</span>
                            <span class="metric-value" id="humidity">58.2%</span>
                        </div>
                        <div class="metric">
                            <span>용해로 온도</span>
                            <span class="metric-value" id="furnaceTemp">742°C</span>
                        </div>
                    </div>

                    <!-- 알람 현황 -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🚨 최근 알람</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div class="alert-box">
                            <span class="alert-icon">⚠️</span>
                            <div>
                                <div style="font-weight: bold;">검사대 #2 진동 이상</div>
                                <div style="font-size: 0.8rem; opacity: 0.9;">2분 전</div>
                            </div>
                        </div>
                        <div style="background: rgba(243, 156, 18, 0.1); color: #f39c12; padding: 0.5rem; border-radius: 8px; margin: 0.5rem 0; font-size: 0.8rem;">
                            <span class="alert-icon">🔧</span>
                            CNC #3 공구 교체 필요 - 15분 전
                        </div>
                    </div>
                </div>
            </div>

            <!-- 라인별 상세 탭 -->
            <div id="lines" class="tab-content">
                <div class="line-selector">
                    <button class="line-btn active" onclick="selectLine('casting')">주조 라인</button>
                    <button class="line-btn" onclick="selectLine('machining')">가공 라인</button>
                    <button class="line-btn" onclick="selectLine('inspection')">검사 라인</button>
                    <button class="line-btn" onclick="selectLine('assembly')">조립 라인</button>
                    <button class="line-btn" onclick="selectLine('packaging')">포장/출하</button>
                </div>
                <div class="dashboard-grid" id="lineDetailContent">
                    <!-- 라인별 상세 정보가 여기에 동적으로 표시됩니다 -->
                </div>
            </div>

            <!-- 예측 분석 탭 -->
            <div id="prediction" class="tab-content">
                <div class="dashboard-grid">
                    <div class="card wide-card">
                        <div class="card-header">
                            <div class="card-title">📈 생산량 예측</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>예상 일일 생산량</span>
                            <span class="metric-value" id="expectedDaily">1,087개</span>
                        </div>
                        <div class="metric">
                            <span>목표 달성률</span>
                            <span class="metric-value" id="achievementRate">98.8%</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🔍 병목 구간 분석</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div style="font-size: 0.9rem;">
                            <div style="color: #e74c3c; margin: 0.5rem 0;">
                                <strong>주요 병목:</strong> <span id="mainBottleneck">검사 라인</span>
                            </div>
                            <div style="color: #7f8c8d; font-size: 0.8rem;">
                                • 평균 대기시간: <span id="waitTime">8.3</span>분<br>
                                • 처리속도: <span id="processingSpeed">85</span>% 목표대비<br>
                                • 권장사항: <span id="recommendation">검사대 추가 운영</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 재고/출하 탭 -->
            <div id="inventory" class="tab-content">
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">📦 현재 재고</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>완제품</span>
                            <span class="metric-value" id="finishedGoods">2,847개</span>
                        </div>
                        <div class="metric">
                            <span>반제품</span>
                            <span class="metric-value" id="wip">394개</span>
                        </div>
                        <div class="metric">
                            <span>안전 재고율</span>
                            <span class="metric-value" id="safetyStock">112%</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🚚 출하 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>금일 출하량</span>
                            <span class="metric-value" id="todayShipment">1,150개</span>
                        </div>
                        <div class="metric">
                            <span>대기 출하량</span>
                            <span class="metric-value" id="pendingShipment">850개</span>
                        </div>
                        <div class="metric">
                            <span>예정 출하</span>
                            <span class="metric-value" id="scheduledShipment">내일 1,200개</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수들
        let scene, camera, renderer, spindle, workpiece;
        let animationId;
        let cncAnimationRunning = true;
        let selectedLine = 'casting';

        // 데이터 객체들
        const appData = {
            productionData: {
                dailyProduction: 847,
                target: 1100,
                overallEfficiency: 84.2
            },
            cncStatus: {
                efficiency: 89.2,
                completed: 47,
                total: 50
            },
            environmentData: {
                temperature: 23.4,
                humidity: 58.2,
                furnaceTemp: 742
            },
            chartData: [
                { value: 42, height: 120 },
                { value: 38, height: 90 },
                { value: 51, height: 150 },
                { value: 45, height: 100 },
                { value: 49, height: 140 },
                { value: 41, height: 95 },
                { value: 47, height: 130 }
            ]
        };

        // 시간 업데이트 함수
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('ko-KR');
        }

        // 탭 전환 함수
        function setActiveTab(tabId) {
            // 모든 탭 콘텐츠 숨기기
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
            });
            
            // 모든 탭 버튼 비활성화
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // 선택된 탭 표시
            document.getElementById(tabId).classList.add('active');
            document.getElementById(tabId).style.display = 'block';
            event.target.classList.add('active');
        }

        // 라인 선택 함수
        function selectLine(lineId) {
            selectedLine = lineId;
            
            // 라인 버튼 활성화
            const lineButtons = document.querySelectorAll('.line-btn');
            lineButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateLineData(lineId);
        }

        // 라인별 데이터 업데이트
        function updateLineData(lineId) {
            const lineDetailContent = document.getElementById('lineDetailContent');
            
            const lineDataMap = {
                casting: `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">주조 라인 - 생산 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>시간당 생산량</span>
                            <span class="metric-value">47개</span>
                        </div>
                        <div class="metric">
                            <span>가동률</span>
                            <span class="metric-value">89.2%</span>
                        </div>
                        <div class="metric">
                            <span>불량률</span>
                            <span class="metric-value">2.1%</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">설비별 상태</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>용해로 온도</span>
                            <span class="metric-value">742°C</span>
                        </div>
                        <div class="metric">
                            <span>주조 압력</span>
                            <span class="metric-value">85 bar</span>
                        </div>
                        <div class="metric">
                            <span>냉각 시간</span>
                            <span class="metric-value">12.3분</span>
                        </div>
                    </div>
                `,
                machining: `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">가공 라인 - 생산 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>시간당 가공량</span>
                            <span class="metric-value">43개</span>
                        </div>
                        <div class="metric">
                            <span>CNC 가동률</span>
                            <span class="metric-value">92.1%</span>
                        </div>
                        <div class="metric">
                            <span>공구 수명</span>
                            <span class="metric-value">78%</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">CNC 장비 상태</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div class="metric">
                            <span>스핀들 속도</span>
                            <span class="metric-value">8,500 RPM</span>
                        </div>
                        <div class="metric">
                            <span>진동 수준</span>
                            <span class="metric-value" style="color: #f39c12;">2.3mm/s</span>
                        </div>
                        <div class="metric">
                            <span>냉각수 온도</span>
                            <span class="metric-value">18°C</span>
                        </div>
                    </div>
                `,
                inspection: `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">검사 라인 - 품질 현황</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div class="metric">
                            <span>검사 통과율</span>
                            <span class="metric-value">96.8%</span>
                        </div>
                        <div class="metric">
                            <span>재검사율</span>
                            <span class="metric-value" style="color: #f39c12;">4.2%</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">검사 장비 상태</div>
                            <div class="status-indicator status-warning"></div>
                        </div>
                        <div class="metric">
                            <span>3D 스캐너</span>
                            <span class="metric-value">정상</span>
                        </div>
                        <div class="metric">
                            <span>치수 측정기</span>
                            <span class="metric-value" style="color: #f39c12;">교정 필요</span>
                        </div>
                        <div class="metric">
                            <span>비전 시스템</span>
                            <span class="metric-value">정상</span>
                        </div>
                    </div>
                `,
                assembly: `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">조립 라인 - 생산 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>시간당 조립량</span>
                            <span class="metric-value">45개</span>
                        </div>
                        <div class="metric">
                            <span>로봇 가동률</span>
                            <span class="metric-value">88.7%</span>
                        </div>
                        <div class="metric">
                            <span>조립 불량률</span>
                            <span class="metric-value">0.8%</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">로봇 시스템 상태</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>로봇 #1</span>
                            <span class="metric-value">정상</span>
                        </div>
                        <div class="metric">
                            <span>로봇 #2</span>
                            <span class="metric-value">정상</span>
                        </div>
                        <div class="metric">
                            <span>컨베이어 속도</span>
                            <span class="metric-value">15 m/min</span>
                        </div>
                    </div>
                `,
                packaging: `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">포장/출하 - 현황</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>시간당 포장량</span>
                            <span class="metric-value">48개</span>
                        </div>
                        <div class="metric">
                            <span>포장 가동률</span>
                            <span class="metric-value">95.2%</span>
                        </div>
                        <div class="metric">
                            <span>RFID 태그율</span>
                            <span class="metric-value">100%</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">출하 준비 상태</div>
                            <div class="status-indicator status-good"></div>
                        </div>
                        <div class="metric">
                            <span>포장 완료</span>
                            <span class="metric-value">1,150개</span>
                        </div>
                        <div class="metric">
                            <span>출하 대기</span>
                            <span class="metric-value">23개</span>
                        </div>
                        <div class="metric">
                            <span>트럭 적재율</span>
                            <span class="metric-value">87%</span>
                        </div>
                    </div>
                `
            };
            
            lineDetailContent.innerHTML = lineDataMap[lineId] || lineDataMap.casting;
        }

        // 장비 선택 함수
        function selectEquipment(equipmentId) {
            console.log('Selected equipment:', equipmentId);
            alert(`${equipmentId} 장비 상세 정보를 표시합니다.`);
        }

        // CNC 애니메이션 토글
        function toggleCncAnimation() {
            cncAnimationRunning = !cncAnimationRunning;
            const btn = document.getElementById('animationBtn');
            
            if (cncAnimationRunning) {
                btn.textContent = '⏸️ 일시정지';
                animate();
            } else {
                btn.textContent = '▶️ 시작';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }

        // CNC 뷰 리셋
        function resetCncView() {
            if (camera) {
                camera.position.set(5, 5, 5);
                camera.lookAt(0, 0, 0);
            }
        }

        // 3D CNC 모델 초기화
        function initCNC() {
            try {
                const container = document.getElementById('cncViewer');
                if (!container || typeof THREE === 'undefined') {
                    console.warn('Three.js 또는 컨테이너를 찾을 수 없습니다.');
                    return;
                }

                // Scene 설정
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x2c3e50);

                // Camera 설정
                camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
                camera.position.set(5, 5, 5);
                camera.lookAt(0, 0, 0);

                // Renderer 설정
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(container.offsetWidth, container.offsetHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // 기존 캔버스 제거 후 새로 추가
                const existingCanvas = container.querySelector('canvas');
                if (existingCanvas) {
                    container.removeChild(existingCanvas);
                }
                container.appendChild(renderer.domElement);

                // 조명 설정
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                directionalLight.position.set(5, 10, 5);
                directionalLight.castShadow = true;
                scene.add(directionalLight);

                // CNC 기계 베이스
                const baseGeometry = new THREE.BoxGeometry(4, 0.5, 3);
                const baseMaterial = new THREE.MeshLambertMaterial({ color: 0x34495e });
                const base = new THREE.Mesh(baseGeometry, baseMaterial);
                base.position.y = -0.25;
                base.receiveShadow = true;
                scene.add(base);

                // 기둥들
                const frameGeometry = new THREE.BoxGeometry(0.3, 3, 0.3);
                const frameMaterial = new THREE.MeshLambertMaterial({ color: 0x7f8c8d });
                
                for (let i = 0; i < 4; i++) {
                    const pillar = new THREE.Mesh(frameGeometry, frameMaterial);
                    const x = (i % 2) * 3 - 1.5;
                    const z = Math.floor(i / 2) * 2 - 1;
                    pillar.position.set(x, 1.5, z);
                    pillar.castShadow = true;
                    scene.add(pillar);
                }

                // 상단 연결부
                const topFrameGeometry = new THREE.BoxGeometry(3.3, 0.2, 0.3);
                const topFrame1 = new THREE.Mesh(topFrameGeometry, frameMaterial);
                topFrame1.position.set(0, 3, -1);
                scene.add(topFrame1);

                const topFrame2 = new THREE.Mesh(topFrameGeometry, frameMaterial);
                topFrame2.position.set(0, 3, 1);
                scene.add(topFrame2);

                // 스핀들 (회전하는 부분)
                const spindleGeometry = new THREE.CylinderGeometry(0.1, 0.1, 1.5);
                const spindleMaterial = new THREE.MeshLambertMaterial({ color: 0xe74c3c });
                spindle = new THREE.Mesh(spindleGeometry, spindleMaterial);
                spindle.position.set(0, 2, 0);
                spindle.castShadow = true;
                scene.add(spindle);

                // 공구
                const toolGeometry = new THREE.ConeGeometry(0.05, 0.3);
                const toolMaterial = new THREE.MeshLambertMaterial({ color: 0xf39c12 });
                const tool = new THREE.Mesh(toolGeometry, toolMaterial);
                tool.position.set(0, -0.9, 0);
                spindle.add(tool);

                // 워크피스 (가공물)
                const workpieceGeometry = new THREE.BoxGeometry(0.8, 0.3, 1.2);
                const workpieceMaterial = new THREE.MeshLambertMaterial({ color: 0x95a5a6 });
                workpiece = new THREE.Mesh(workpieceGeometry, workpieceMaterial);
                workpiece.position.set(0, 0.4, 0);
                workpiece.castShadow = true;
                workpiece.receiveShadow = true;
                scene.add(workpiece);

                // 작업 테이블
                const tableGeometry = new THREE.BoxGeometry(2.5, 0.2, 2);
                const tableMaterial = new THREE.MeshLambertMaterial({ color: 0x2c3e50 });
                const table = new THREE.Mesh(tableGeometry, tableMaterial);
                table.position.set(0, 0.1, 0);
                table.receiveShadow = true;
                scene.add(table);

                // 냉각수 파티클 효과
                for (let i = 0; i < 15; i++) {
                    const particleGeometry = new THREE.SphereGeometry(0.01);
                    const particleMaterial = new THREE.MeshLambertMaterial({ 
                        color: 0x3498db, 
                        transparent: true, 
                        opacity: 0.6 
                    });
                    const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                    particle.position.set(
                        Math.random() * 0.4 - 0.2,
                        1.5 + Math.random() * 0.5,
                        Math.random() * 0.4 - 0.2
                    );
                    scene.add(particle);
                }

                animate();
                console.log('3D CNC 모델 초기화 완료');
            } catch (error) {
                console.error('3D 초기화 오류:', error);
            }
        }

        // 애니메이션 함수
        function animate() {
            if (!cncAnimationRunning) return;
            
            try {
                animationId = requestAnimationFrame(animate);

                // 스핀들 회전
                if (spindle) {
                    spindle.rotation.y += 0.3;
                }

                // 워크피스 미세 이동 (가공 시뮬레이션)
                if (workpiece) {
                    workpiece.position.x = Math.sin(Date.now() * 0.001) * 0.1;
                    workpiece.position.z = Math.cos(Date.now() * 0.0015) * 0.08;
                }

                // 카메라 자동 회전
                if (camera) {
                    const time = Date.now() * 0.0005;
                    camera.position.x = Math.cos(time) * 8;
                    camera.position.z = Math.sin(time) * 8;
                    camera.lookAt(0, 1, 0);
                }

                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
            } catch (error) {
                console.error('애니메이션 오류:', error);
            }
        }

        // 차트 업데이트
        function updateChart() {
            const chartContainer = document.getElementById('productionChart');
            chartContainer.innerHTML = '';
            
            appData.chartData.forEach((bar, index) => {
                const barElement = document.createElement('div');
                barElement.className = 'chart-bar';
                barElement.style.height = bar.height + 'px';
                barElement.textContent = bar.value;
                chartContainer.appendChild(barElement);
            });
        }

        // 실시간 데이터 시뮬레이션
        function simulateRealTimeData() {
            try {
                // 생산 데이터 업데이트
                appData.productionData.dailyProduction = Math.floor(Math.random() * 50) + 820;
                appData.productionData.overallEfficiency = Math.floor(Math.random() * 10) + 80;
                
                const progressPercent = Math.min(100, (appData.productionData.dailyProduction / appData.productionData.target) * 100);

                // DOM 업데이트
                document.getElementById('dailyProduction').textContent = `${appData.productionData.dailyProduction} / ${appData.productionData.target}`;
                document.getElementById('overallEfficiency').textContent = `${appData.productionData.overallEfficiency}%`;
                document.getElementById('progressFill').style.width = `${progressPercent}%`;

                // CNC 상태 업데이트
                appData.cncStatus.efficiency = Math.floor(Math.random() * 10) + 85;
                appData.cncStatus.completed = Math.floor(Math.random() * 10) + 40;
                
                document.getElementById('cncEfficiency').textContent = appData.cncStatus.efficiency;
                document.getElementById('completed').textContent = appData.cncStatus.completed;

                // 환경 데이터 업데이트
                appData.environmentData.temperature = (Math.random() * 3 + 22).toFixed(1);
                appData.environmentData.humidity = (Math.random() * 10 + 55).toFixed(1);
                appData.environmentData.furnaceTemp = Math.floor(Math.random() * 20) + 735;

                document.getElementById('temperature').textContent = `${appData.environmentData.temperature}°C`;
                document.getElementById('humidity').textContent = `${appData.environmentData.humidity}%`;
                document.getElementById('furnaceTemp').textContent = `${appData.environmentData.furnaceTemp}°C`;

                // 차트 데이터 업데이트
                appData.chartData = appData.chartData.map(bar => ({
                    value: Math.floor(Math.random() * 20) + 35,
                    height: Math.floor(Math.random() * 80) + 90
                }));

                updateChart();
            } catch (error) {
                console.error('데이터 시뮬레이션 오류:', error);
            }
        }

        // 윈도우 리사이즈 이벤트
        function handleResize() {
            if (camera && renderer) {
                const container = document.getElementById('cncViewer');
                if (container) {
                    camera.aspect = container.offsetWidth / container.offsetHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.offsetWidth, container.offsetHeight);
                }
            }
        }

        // 초기화 함수
        function initialize() {
            console.log('대시보드 초기화 시작...');
            
            // 시간 업데이트 시작
            updateTime();
            setInterval(updateTime, 1000);
            
            // 실시간 데이터 시뮬레이션 시작
            setInterval(simulateRealTimeData, 3000);
            
            // 초기 차트 렌더링
            updateChart();
            
            // 초기 라인 데이터 설정
            updateLineData('casting');
            
            // 3D 초기화 (약간 지연 후)
            setTimeout(() => {
                if (typeof THREE !== 'undefined') {
                    initCNC();
                } else {
                    console.warn('Three.js를 로드할 수 없습니다. 3D 기능이 비활성화됩니다.');
                }
            }, 1000);
            
            // 리사이즈 이벤트 리스너
            window.addEventListener('resize', handleResize);
            
            console.log('대시보드 초기화 완료!');
        }

        // DOM이 로드되면 초기화 실행
        document.addEventListener('DOMContentLoaded', initialize);

        // 페이지 언로드 시 정리
        window.addEventListener('beforeunload', () => {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (renderer) {
                renderer.dispose();
            }
        });
    </script>
</body>
</html>
                